Options -Indexes

<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  Header set Content-Security-Policy "default-src 'self'; img-src 'self' data:; script-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self' data:"
</IfModule>

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault "access plus 1 month"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/json "access plus 1 day"
  ExpiresByType image/svg+xml "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
</IfModule>

<IfModule mod_rewrite.c>
RewriteEngine On

# Return forbidden for sensitive files
RewriteRule ^(.*/)?(\.env|\.htaccess|\.gitignore|.*\.(sql|bak|tar|zip))$ - [F,L]

# Force 404 for non-public paths
RewriteRule ^(src|database|doc|docs|documentations|config|tests|vendor|node_modules|composer\.json|composer\.lock)(/.*)?$ - [R=404,L]

# Block PHP execution inside uploads
RewriteRule ^uploads/.*\.(php[0-9]?|phtml|phar)$ - [F,L]

# Block hidden files
RewriteRule (^|/)\. - [F,L]

# Serve existing files/directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Fallback to index.php
RewriteRule ^ index.php [L]
</IfModule>

<IfModule mod_headers.c>
  <FilesMatch "\.(woff2?|ttf|otf|eot)$">
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, OPTIONS"
    Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept"
  </FilesMatch>
</IfModule>

AddType font/woff2 .woff2
AddType application/font-woff .woff
